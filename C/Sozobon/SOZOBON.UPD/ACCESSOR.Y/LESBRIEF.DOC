072040000060000144008000000012000
11
21
F0110030001
9[...................................................]0010
Ä
Leserbriefzu


ÅAccessoriesinSozobonCÄ


verîffentlichtimAtariPDJournal9/90.



AufderLeserbriefseitedesPDJournals6/90(Seite79)fragtein
Leseran,warumesnichtmîglichist,AccessoriesinSozobonCzu
programmieren.SiegebenihmzurAntwort,daûSiedarÅberkeine
Informationenhabenunddeshalbnichtssagenkînnen.Daichmir
dieseFrageschonvorlÑngererZeitgestellthabe,mîchteich
ihnendieAntworten,dieichgefundenhabe,mitteilen.

DieUrsachefÅrdas"Wegbomben"vonAccessoriesisteinerseitsim
Start-Up-CodeDSTART.O(imUnterverzeichnisLIB)zusuchen.Dort
isteinerdererstenBefehle

     move.l    4(sp),a4

Diesbewirktnormalerweise,daûdieAdressederBasepageindas
Registera4geladenwird.BeiAccessoriesstehtandieserStelle
jedoch0L,sodaûinweitererFolgeversuchtwirdaufden
geschÅtztenSpeicherbereichabderAdresse0x000000zuzugreifen.
UndschonhabenwirdieBomben!EsistdahereineLeichtigkeit
(vorallem,davorbildlicherweisederSource-Textmitgeliefert
wird),denStart-Up-Codeauf

     move.l    #_start-256,a4

zuÑndern,wasinjedemFallklappt.

Leiderreichtdasnochnicht,denndieProgrammierervonSozobon
ChabennocheinenHakeneingebaut:derStackwirdnichtimBSS-
Segmentangelegt,sonderndanach.Ein"normales"Programmbleibt
davonunberÅhrt,daesnachdemStartdennichtbenîtigten
SpeicherplatzselbstfreigibtundesdaheregalistwoderStack
liegt.BeidenAccessorieshingegengibtGEMdennichtbenîtigten
PlatzselbstfreiundGEMgehtdavonaus,daûdasAccessorynur
dieSummederdreiSegmente(TEXT,DATAundBSS)plus256Bytes
fÅrdieBasepagebraucht.DernachdemBSS-Segmentangelegte
StackwirddadurchirgendwannvonirgendwelchenDatenÅber
schriebenundbeimAnklickendesAccessoriesbombtderComputer
weg.HieristeineeinfacheHilfenichtmîglich,dadarauf
RÅcksichtgenommenwerdenmuû,daûderStackverschiedengroû
seinkann(definiertdurch_STKSIZ).AlsLîsunghabeichmirdie
Include-DateiSTACK.Hgebastelt,dieeinenBereichdefiniert,der
alsStackverwendetwirdundimBSS-Segmentliegt.DieDatei
brauchtnurindasAccessoryincludiertwerden,durchvorher
gehendesdefinierenvon_STCK_SIZEkanndieStackgrîûeverÑndert
werden.ZuBeginnderRoutinemain()muûdieProzedurnew_stack()
aufgerufenwerden,diedenStackpointeraufdiesenneuenBereich
legt.Darausfolgt,daûinderProzedurmain()keinelokalen
VariablendefiniertseindÅrfen!SolldasProgrammauch"normal"
laufen,somuûvorVerlassenvonmain()dieProzedurold_stack()
aufgerufenwerden,diedenStackpointerwiederaufseinenalten
WertzurÅcksetzt.

ÄDaAccessorieskeineKommandozeilehabenundauchdenSpeicher
platznicht selbstfreigebenmÅssen,habeichdieseProgrammteile
imStart-Up-CodefÅrAccessoriesÅbersprungen.Derentsprechend
geÑnderterStart-Up-CodeliegtaufderDiskettealsSourceund
alsObjekt-Dateibei.UmdemProgrammiererdieArbeitnochein
biûchenzuerleichtern,habeichzusÑtzlichdieglobaleint-
Variable_isacc(C-Name)definiert,die-1enthÑlt,wenndas
ProgrammalsAccessorygestartetwurde,ansonsten0.(Kanndaran
erkanntwerden,daûderZeigeraufdieParents-BasepageOffset
0x24beiAccessoriesdenWertNULLhat,beinormalenProgrammen
einenWertungleichNULL.)DamitkanneinProgrammsoaufgebaut
werden,daûessowohlalsPRGalsauchalsACClauffÑhigist.Ein
BeispielhabeichalsSource-Text,ProgrammundAccessoryaufder
Diskettebeigelegt.

NocheineénderunghabeichimStart-Up-Codevorgenommen:Soll
einProgrammimSpeicherresidentgehaltenwerden(Ausstiegmit
Ptrmres()),somuûderProgrammiererAnfangsadresseundProgramm
lÑngekennen.DieAnfangsadresseistimmerdieBasepage,dieÅber
dieglobalelong-Variable_basezurVerfÅgunggestelltwird,bei
derProgrammlÑngehingegenwirderalleinegelassen.EinAufsum
mierenderLÑngenvonTXT-,DATA-undBSS-Segmentergibtzwardie
ProgrammlÑnge,eswirddabeiaberderStack(Grîûedurchdie
long-Variable_STKSIZeinstellbar)nichtberÅcksichtigt,derja
nachdemBSS-Segmentangelegtwird(dasEndedesBSS-Segmentes
istÅberdieVariablelongenderreichbar).DerWitzistdabei,
daûbeimSystemstartimStart-Up-ModuldastatsÑchlicheEndedes
Programmeszwarberechnetwird,umdennichtbenîtigten
SpeicherplatzmittelsMshrink()freizugeben,derWertaber
nirgendsabgespeichertwird.Darumhabeichdieglobalelong-
Variable_endprog(C-Name)eingefÅhrt,diediesenWertaufnimmt
unddemProgrammiererzugÑnglichmacht.

ZumAbschluûmîchteichnocheineEigenentwicklungbeilegen:Eine
grafischeShellfÅrdenC-Compiler.EshatmichimmergeÑrgert
miteinerBatch-DateiarbeitenzumÅssenundCommandLine
Interfacehabe(undwill-dakînnteichjagleicheinenDOS-
Rechnerkaufen!)ichauchkeines."GrafischeShell"ist
vielleichtetwaszuhochgegriffen,eshandeltsicheigentlich
nurumeinProgrammmitdemsichdieParameterfÅrdenCompiler
CCetwaskomfortablereinstellenlassen.KurzdieBedienung:

StartendesProgrammesCCOMP.PRG,eserscheinteineFSEL-Box,bei
derdaszukompilierendeProgrammausgewÑhltwerdenkann.Danach
kommteineDialog-BoxbeiderfolgendeEinstellungenmîglich
sind:
-    NamederÅbersetztenProgrammes(ohneExtension)
-    ExtensiondesProgrammes(.TOS,.TTP,.PRGoder.ACC)
-    Angaben,obnachdemCompilerderOptimizer(O-Option),der
     Assembler(S-Option)undderLinker(c-Option)gestartet
     werdensoll
-    Angaben,obdieVDI-unddieAES-Bibliothekenmitgebunden
werdensollen(kannNICHTvonderExtensionabgeleitet
werden,danichtalleGEM-ProgrammedieVDI-Bibliothek
brauchenundnichtalleswasmit.PRGendeteinGEM-Programm
ist->AUTO-Ordner-Programme)
-    vierZeilenindenennochweitereUnterverzeichnisse
eingegebenwerdenkînnen,dienach*.HDateiendurchsucht
werden(I-Option)
-vierFelderfÅrzudefinierendeNamen(D-Option)
-vierFelderfÅrzuundefinierendeNamen(U-Option)
-Angabe,obdieVersions-Meldungausgegebenwird(v-Option)
Ä-Angabe,obeineSymbol-Tabelleerzeugtwerdensoll(t-
Option)
-Angabe,obeineloadmaperzeugtwerdensoll(m-Option)
-Angabe,obdieFlieûkommabibliothekfÅrprinf()mitgebunden
werdensoll
DurchAnklickenvonOKwirderCompilergestartet.Dader
CompilerunddieanderenProgrammeleideraufSTDERRausgebenund
diesesmitderHandle-Nummer-1nichtumgelenktwerdenkann,
habeichesohneEingriffeindieBetriebssystemaufrufenicht
geschafftdieAusgabeaufetwasanderesalsdenBildschirm(z.B.
eineDatei)umzulenken.

Wasistnunzubeachten?
1)DieinderDialog-BoxgetroffenenEinstellungenwerdeninder
DateiCCOMP.INFabgelegtundwerdenbeimnÑchstenMalwiedervon
dortgeladen.DieDateimuûnichtvorhandensein,siewirdbeim
erstenAufrufangelegt.EsgibtkeineOptionsienichtzu
erzeugen(alsoAchtungbeischreibgeschÅtzenDisketten!)undes
gibtsienureinmal,sieistalsofÅralleProgrammegleich.

2)DieVDI-undAES-BibliothekhabeichaufdieMinimalnamenV.A
undA.Aumbenannt.Diesdeshalb,daeinProgrammnur128Bytes
KommandozeilehabenkannundbeiderAngabevonvielenOptionen
sinddiebaldverbraucht.

3)DamitdasGanzeÅberhauptfunktioniertmuûdieDateiCCOMP.ENV
vorhandensein.DieseDateiisteineASCII-Dateimitfolgendem
Inhalt:inder1.ZeilemuûdervollstÑndigerPfadundNamedes
ProgrammesCCstehen(alsoz.B.C:\SOZOBON\BIN\CC.TTP),inden
folgendenZeilensinddieEnvironment-Variablen,diederCompiler
CCbraucht,inbeliebigerReihenfolgedefiniert.PATH=gibtan,
woerdieProgrammeHCC,JAS,TOPundLDsucht(z.B.
PATH=C:\SOZOBON\BIN);LIB=gibtan,woerdieBibliothekensucht
(z.B.LIB=C:\SOZOBON\LIB);INCLUDE=gibtan,woerdie*.H
Dateiensucht(z.B.INCLUDE=C:\SOZOBON;C:\SOZOBON\INCLUDE);TMP=
gibtan,woertemporÑreDateienanlegt(z.B.
TMP=C:\SOZOBON\TMP).WieamdrittenBeispielersichtlichist,ist
esauchmîglichmehrereUnterverzeichnissemit";"getrennt
anzugeben.

4)AufdieUnterstÅtzungderOptionenp(executionprofiling)und
n(gibtnurdieVersions-Nummernaus)wurdeverzichtet,dadie
ersterelautDokumentationnichtfunktioniertundichinder
zweitenwenigSinnsehe.

5)WemderNamederProgrammesCCOMP.PRGnichtgefÑllt,kannes
beliebigumbenennen.DieDateien.RSC,.ENVund.INFmÅssendann
ebenfallsdiesenNamentragen,dadasProgramm-egalwiees
heiût-immerdeneigenenNamen(samtLaufwerkund
Unterverzeichnissen)vorausstellt.

6)CCOMPunterstÅtztderzeitnichtdasgleichzeitigekompilieren
undbindenmehrererModule.AberwennmiretwaseinfÑllt,wiedas
benutzerfreundlichgehenkann(ohnezig-maleineFSEL-Box
anzuklicken),werdeichesnocheinbauen.

EinMangelimSozobonCseinocherwÑhnt:derOptimizernimmtals
Eingabeeine.S-DateiunderzeugteineTMP-Datei,diedannfÅr
denAssemblerineine.S-DateimitdemOriginalnamenumbenannt
wird.DieTMP-DateiliegtimmeraufdemLaufwerk,aufdemauch
derCompilersteht,die.S-Dateikînnteauchaufeinemanderen
Laufwerkstehen.Kînnte,aberkannnichtdanÑmlichdieC-
ÄFunktionrename(),diehierverwendetwird,eszwarschafftein
DateivoneinemUnterverzeichnisaufeinandereszu"renamen"
(kommteinemMOVEgleich),esabernichtschafft,eineDateivon
einemLaufwerkaufeinandereszuschaufeln.(Istauchganzklar,
dabeimrename()aufdemgleichenLaufwerknureineDirektory-
Manipulationnotwendigist,dieDateibleibphsyikalischgesehen
aufdergleichenStelle.)EinBeispielsolldiesverdeutlichen:
DiezukompilierendeDateiheiûtA:\TEST.C.DerCompilerHCC
erzeugtdieDateiA:\TEST.SundÅbergibtsiedemOptimizer,der
erzeugtdieDateiC:\SOZOBON\TOPT.TMP(odersoÑhnlich).Der
CompilerCCkanndieseDateiabernichtinA:\TEST.Sumbenennen,
derAssemblersteigtdraufhinmiteinemFehleraus.

So,ichglaubedaswardasWichtigste.AufjedenFallhabeich
alleDateienaufderDiskettebeigelegt.VielleichtkanndasZeug
irgendjemandbrauchen.

Nochwas:alleProgrammehabeichfÅrmeinSystem(1040STF,
doppelseitigesLaufwerk,monochromerBildschirm,TOS 1.2)
geschrieben.Ichweiûdahernicht,obsieaufanderenKonfigura
tionenlaufen,obwohlichaufalleTricks,wiedirekteSystem
eingriffe,verzichtethabe.Weiterhinhabeichdasallesals
ArbeitshilfefÅrmichentworfen,undnichtumdamitaufirgend
eineArtGeldzuverdienen.ALLEPROGRAMMESINDDAHERBELIEBIG
KOPIERBARUNDBELIEBIGéNDERBAR.SolltejemandeinenFehler
finden,sowÑreichtrotzdemfroh,wenner/sieihnmirmitteilt.


MarkusMÅller
Meissauergasse2A/5/15
1222Wien
ôsterreich

