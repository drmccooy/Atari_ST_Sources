ZORG, Copyright Ludovic Rousseau 1993, 1994



                             DISQUE



  Voici une vue d'ensemble d'une disquette, d'une partition ou d'un disque dur
entier.


  On peut trouver les valeurs exactes … partir du BPB (Bios Parameter Bloc)
obtenu par 'BPB *Getbpb( int dev );'. Cet appel Bios rend un pointeur sur une
structure BPB :

    typedef struct               /* used by Getbpb */
    {
         int recsiz;
         int clsiz;
         int clsizb;
         int rdlen;
         int fsiz;
         int fatrec;
         int datrec;
         int numcl;
         int bflags;
    } BPB;

  - recsiz est la taille du secteur en octets (512);
  - clsiz est la taille du bloc en secteurs (en g‚n‚ral 2);
  - clsib est la taille du bloc en octets (resciz * clsiz);
  - rdlen est la taille du r‚pertoire en secteurs;
  - fsiz est la taille de la FAT en secteurs;
  - fatrec est le num‚ro de secteur de la deuxiŠme FAT;
  - datrec est le num‚ro de secteur du premier bloc de donn‚es;
  - numcl est le nombre de blocs de donn‚es;
  - bflags contient des drapeaux divers.


         Label          Secteur
    +-----------------+   0
    | Boot Secteur    |
    +-----------------+   1
    |                 |
    |   1Šre FAT      |
    |                 |
    +-----------------+   fatrec ou fsiz + 1
    |                 |
    |   2Šme FAT      |
    |                 |
    +-----------------+   2*fsiz + 1
    |                 |
    |   R‚pertoire    |
    |    Racine       |
    |                 |
    +-----------------+   datrec ou rdlen + 2*fsiz + 1
    |  Cluster 2      |
    +-----------------+   datrec + clsiz
    |  Cluster 3      |
    +-----------------+   datrec + 2*clsiz
    |                 |
    |    ...          |
    |                 |
    +-----------------+   datrec + (numcl - 1)*clsiz
    | Cluster numcl+2 |
    +-----------------+   datrec + numcl*clsiz


  On voit que le r‚pertoire principal a une taille fix‚e au formatage du
disque. Ce r‚pertoire n'est donc pas un fichier ordinaire contrairement aux
autres r‚pertoires.

  La num‚rotation des blocs de donn‚es commence au num‚ro 2 car les deux
premiŠres entr‚es de la FAT sont d‚j… occup‚es et ne font pas r‚f‚rence … des
blocs.



  Un disque dur n'est qu'un ensemble de partitions dont la structure est la
mˆme qu'une disquette. Il y a en plus un boot sector et un ou plusieurs
secteurs contenant la liste des secteurs d‚fectueux.


         Label          Secteur
    +-----------------+   0
    | Boot Secteur    |
    +-----------------+   1
    | Bad Sector List |
    +-----------------+   p0_st
    |                 |
    |   Partition 0   |
    |                 |
    +-----------------+   p1_st
    |                 |
    |   Partition 1   |
    |                 |
    +-----------------+
    |                 |
    |      ...        |
    |                 |
    +-----------------+   pn_st
    |                 |
    |   Partition n   |
    |                 |
    +-----------------+   hd_siz

  p0_siz … p3_siz ainsi que hd_siz sont dans le boot secteur du disque. La
liste des secteurs d‚fectueux n'est pas forc‚ment au d‚but du disque. Elle se
trouve juste aprŠs le boot sector sur mon disque mais ‡a ne doit pas ˆtre
partout pareil. La position de cette liste est elle aussi indiqu‚e dans le boot
secteur. Le fichier HD_BOOT.TXT donne toutes les informations contenues dans ce
fameux boot sector.
