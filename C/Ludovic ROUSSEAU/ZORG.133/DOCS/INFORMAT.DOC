ZORG, Copyright Ludovic Rousseau 1993, 1994



                             INFORMATIONS


  Menu Informations

Information (Alternate I)
  Donne des informations sur le disque actuel. En fait le programme affiche les
informations contenues dans le BPB (Bios Parameter Bloc) et le boot sector du
disque. Si c'est une disquette il y a en plus le nombre de faces, secteurs et
pistes de la disquette.

Occupation (Alternate O)
  Ouvre une fenˆtre graphique. Chaque petit carr‚ noir correspond … un cluster
occup‚. Le blanc est donc la place libre restante. Les 'Bad blocks' (secteurs
d‚fectueux) sont marqu‚s par un carr‚ gris. Il y a ‚galement un carr‚ gris qui
indique la fin du disque qui n'est pas forc‚ment juste dans le coin en bas …
droite. On peut alors voir l'‚tat de bordel et de d‚labrement du disque ou le
taux d'occupation.

Statistiques (Alternate E)
  Donne le nombre total de blocs (clusters) du disque, le nombre de blocs
libres et de blocs occup‚s et les pourcentages que ‡a repr‚sente. On a aussi le
niveau de fragmentation du disque en nombre de morceaux. On peut compter les
morceaux de donn‚es avec la fenˆtre d'occupation mais c'est fatiguant. On a
‚galement un d‚compte du nombre de dossiers, fichiers et de fichiers
fragment‚s. Les fichiers fragment‚s sont ceux dont les clusters ne se suivent
pas sur disque et que la prochaine version de ZORG devrait d‚fragmenter. Un
fichier fragment‚ est moins efficace qu'un fichier continu car la tˆte de
lecture doit faire un ou plusieurs sauts au cours de la lecture du
fichier.


-------------------------------------------------------------------------------

Changement Disque (Alternate K)
  TrŠs important. Le programme gŠre des caches en interne pour ne pas avoir …
relire la structure … chaque manipulation. Si on change de disque ou si on
modifie la structure, le cache n'est plus valable et il faut le changer. Un
changement de disquette est normalement d‚tect‚ et un 'Changement Disque' est
effectu‚ mais on peux vouloir le forcer. Pour gagner de la place m‚moire ou
aprŠs un modification de la structure du disque par exemple.

Tracer un Fichier (Alternate L)
  Donne la liste des clusters d'un fichier. Si la suite n'est pas contigu‰, le
programme affiche un \ et va … la ligne.

Teste la Structure (Alternate T)
  Cette entr‚e de menu est trŠs importante. C'est grƒce … elle qu'on peut
v‚rifier qu'un disque n'a pas de problŠmes de structure de l'arborescence. les
fonctions de ZORG considŠrent … priori que le disque est en bon ‚tat et donc ne
v‚rifient pas que tout va bien. Cet optimisme permet d'aller vite mais …
l'inconv‚niant de tout planter dŠs que la structure … un problŠme (par exemple
une boucle infinie dans le chaŒnage des cluster d'un fichier). Il faut donc
ˆtre s–r que le disque qu'on donne … ‚tudier … ZORG est bien en rŠgle et donc
Tester la Structure de temps en temps.
  
    La proc‚dure de test v‚rifie plusieurs choses :
    - La taille de la FAT correspond aux dimensions du disque. Connaissant le
nombre de clusters du disque on peut en d‚duire la taille normale de la FAT (2
octets par cluster sur disque dur et 1.5 sur disquette). Si la FAT est trop
grande ‡a n'est pas un problŠme (j'ai une partition comme ‡a avec une FAT trop
grande d'un secteur) mais on perd un peu de place sur disque.
    - L'‚galit‚ des deux FATs. Un disque comporte normalement deux FATs et il
vaut mieux que les deux FATs soients identiques. En cas de diff‚rence ZORG
int‚rompt la proc‚dure.
  - Le r‚pertoire '.' pointe bien sur lui-mˆme.
  - Le r‚pertoire '..' pointe sur le pŠre.
    - La taille d'un fichier et le nombre de cluster qui lui sont associ‚s
correspondent.

    - Un fichier contient un/des cluster(s) en dehors du disque (la tˆte de
lecture n'aime pas trop ‡a).
  - Un cluster est occup‚ par plus d'un fichier.
  - Un cluster est marqu‚ comme occup‚ mais n'appartient en r‚alit‚ … aucun
fichier.

  
    La seule erreur que ZORG corrige est la derniŠre (un cluster marqu‚ occup‚
alors qu'il ne l'est pas). Dans ce cas ZORG crŠe un ou plusieurs fichiers
'FILEnnnn.ZRG' dans le r‚pertoire racine qui contiennent les clusters occup‚s
pour rien. Libre … vous aprŠs de le effacer.

    Correction des autres erreurs :
    - Les deux FATs sont diff‚rentes. C'est un cas difficile. Il faut savoir
quels sont les bonnes informations et les mauvaises. Avec un peu de chance
seule une des deux FAT a ‚t‚ alt‚r‚e et il suffit de recopier l'autre (la
bonne) par dessus.
    - Les r‚pertoires '.' et '..' ne pointent pas l… o— ils devraient. Il
suffit de forcer la valeur de leur premier cluster (avec 'Ouvrir un
R‚pertoire').

    - La taille d'un fichier et le nombre de clusters allou‚s ne correspondent
pas. Le plus simple est de modifier la taille du fichier pour qu'il occupe tout
les secteurs donn‚s et de l'‚diter ensuite pour voir d'o— viennent les clusters
supl‚mentaires ou au contraire ce qui manque au fichier.
    - Un cluster est en dehors du disque. Le fichier a alors un gros problŠme.
Le plus simple est d'effacer le fichier en mettant le premier caractŠre de son
nom … xE5 et de relancer un test de la structure. Les clusters ainsi lib‚r‚s
sont r‚cup‚r‚s dans les fichiers 'FILEnnn.ZRG'. De toute fa‡on le fichier ‚tait
d‚j… trŠs mal barr‚.
    - Un cluster est occup‚ par plus d'un fichier. Un des fichiers n'a pas …
utiliser ce cluster et doit doit donc mourir (hop, on l'efface comme dans le
cas pr‚c‚dent).
  
    En gros on peut r‚sumer que quand un fichier … un problŠme avec sa liste de
clusters, le plus simple est d'effacer le fichier et de relancer un test pour
r‚cup‚rer proprement les clusters lib‚r‚s. On vois ici l'int‚rˆt d'‚ffectuer
r‚guliŠrement des backups. Si vous ˆtes amen‚ … effacer un fichier, il vaut
mieux en avoir une copie quelque part.
    On peut aussi remarquer que la proc‚dure de test permet d'avoir une
description interne de l'arborescence un peu moins sensible aux erreurs que
celle utilis‚e … priori. Il vaut mieux faire un test avant de manipuler les
fichiers si la structure … des problŠmes.

A partir de ZORG.INF
  Ce choix permet d'utiliser les informations indiqu‚es dans le fichier de
configuration ZORG.INF plut“t que les informations d‚livr‚es par le systŠme.
Ceci permet d'ˆtre totalement ind‚pendant du systŠme, par exemple pour avoir
accŠs aux partitions mˆme si le disque n'a pas booter et que le systŠme ne sait
pas qu'il y a des partitions. Cette possibilit‚ peut ˆtre trŠs utile si le boot
sector du disque dur … ‚t‚ modifi‚ et que le disque ne veut plus booter. Il
vaut mieux configurer ZORG.INF avant que le problŠme ne survienne. Une partie
des informations peuvent ˆtre obtenues avec l'entr‚e de menu 'Configuration' du
menu 'Ouvre', le reste de la configuration s'obtient avec l'entr‚e 'Lire'
d‚crite juste aprŠs.

-------------------------------------Boot--------------------------------------

Lire
  Exclusivement pour les disques durs. Permet de lire le secteur 0 du disque.
Ce secteur contient une description du disque (nombre de faces, de cylindres,
zone de repos...) et des partitions et permet de faire booter le disque (si le
secteur est ex‚cutable). On lit aussi le(s) secteur(s) o— se trouve la liste
des secteurs d‚fectueux (le secteur 1 chez moi).
  Vous devez donner le num‚ro du p‚riph‚rique (de 1 … 8) ainsi que le moyen d'y
acc‚der. En indiquant 'ACSI' ou 'SCSI' le programme va utiliser l'appel systŠme
DMAread() qui n'existe que sur TT et Falcon malheureusement. Avec 'ZORG' le
programme utilise ses propres routines de lecture.
  Le systŠme possŠde d‚j… une fonction pour lire le secteur 0, c'est Rwabs()
avec un 'rwflag' de 8. Le problŠme est que cette commande de lecture d'un
secteur en absolu n'est pas document‚e (je l'ai trouv‚e en desassemblant mon
driver AHDI) et ne doit donc pas ˆtre utilis‚e sous peine de ne pas marcher
avec un autre driver que AHDI 5.0 et sup‚rieur (peut-ˆtre ant‚rieur mais je ne
sais pas).

Ecrire
  Option invalide tant qu'on n'a pas lu un boot avec 'Lire' ou 'Charger du
Disque'. Ecrit les donn‚es lues sur le secteur 0. ATTENTION : faites gaffe … ne
pas ‚crire n'importe quoi. Je vous conseille de lire le boot une fois, de le
sauvegarder sur une disquette pendant que le disque dur marche encore pour
pouvoir le r‚‚crire aprŠs un malencontreux accident. Le mˆme conseil s'applique
aussi aux boots sectors des partitions. Un boot sector est si vite effac‚... Ca
m'est arriv‚ et c'est toujours trŠs embˆtant de perdre une partition de 15
M‚gas.


Charger du disque
  Relit un fichier sauvegard‚ avec 'Sauver sur Disque'. Le programme demande si
on veut voir les informations du boot. Ces informations sont automatiquement
affich‚es avec 'Lire'.

Sauver sur Disque
  Sauve les donn‚es r‚cup‚r‚es avec 'Lire' ou 'Charger du Disque'.


  Pour voir ce que contient le boot sector il faut le lire, le sauver sur
disque et ouvrir le fichier sauv‚ ('Ouvrir un Fichier').
